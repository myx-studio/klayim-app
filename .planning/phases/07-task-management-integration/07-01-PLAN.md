---
phase: 07-task-management-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared/src/types/task.ts
  - packages/shared/src/types/index.ts
  - apps/api/package.json
autonomous: true
requirements: [TASK-04, TASK-05]

must_haves:
  truths:
    - "Task type represents normalized task data from any provider"
    - "Time tracking fields handle Asana/ClickUp data and Linear estimates"
    - "SDKs are installed and importable"
  artifacts:
    - path: "packages/shared/src/types/task.ts"
      provides: "Task, TaskStatus, TaskProvider, TaskTimeEntry types"
      exports: ["Task", "TaskStatus", "TaskProvider", "TaskTimeEntry", "SyncState"]
    - path: "apps/api/package.json"
      provides: "asana and @linear/sdk dependencies"
      contains: '"asana"'
  key_links:
    - from: "packages/shared/src/types/task.ts"
      to: "packages/shared/src/types/index.ts"
      via: "re-export"
      pattern: "export.*task"
---

<objective>
Install task management SDKs and create Task types for normalized task storage

Purpose: Establish foundation types and dependencies that provider services will use
Output: Task/TaskTimeEntry types, installed asana and @linear/sdk packages
</objective>

<execution_context>
@/Users/ardiansyahiqbal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ardiansyahiqbal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-task-management-integration/07-RESEARCH.md

# Existing types to follow pattern
@packages/shared/src/types/calendar.ts
@packages/shared/src/types/employee.ts
@packages/shared/src/types/integration.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install task management SDKs</name>
  <files>apps/api/package.json</files>
  <action>
Install the Asana and Linear SDKs in the API package:

```bash
cd apps/api && npm install asana @linear/sdk
```

- asana: Official Node.js SDK v3 for Asana API
- @linear/sdk: Official TypeScript SDK for Linear GraphQL API
- ClickUp has no official SDK - will use direct fetch with typed responses

Note: Per research, use asana v3 (not v1 which is deprecated)
  </action>
  <verify>
```bash
cd apps/api && npm ls asana @linear/sdk
```
Both packages should be listed as installed dependencies
  </verify>
  <done>asana and @linear/sdk packages installed in apps/api</done>
</task>

<task type="auto">
  <name>Task 2: Create Task types for normalized storage</name>
  <files>packages/shared/src/types/task.ts, packages/shared/src/types/index.ts</files>
  <action>
Create Task types following the CalendarEvent pattern from calendar.ts:

**packages/shared/src/types/task.ts:**

```typescript
/**
 * Task provider sources
 */
export type TaskProvider = "asana" | "clickup" | "linear";

/**
 * Normalized task status across providers
 */
export type TaskStatus = "todo" | "in_progress" | "done" | "cancelled";

/**
 * Time tracking entry for tasks (Asana and ClickUp)
 * Linear only has estimates, no time entries
 */
export interface TaskTimeEntry {
  id: string;
  taskId: string;
  durationMinutes: number;
  startedAt?: string;
  createdAt: string;
  userId?: string; // External user ID from provider
}

/**
 * Normalized task representation across all providers
 *
 * Field mapping:
 * - Asana: gid -> externalId, completed_at -> completedAt, actual_time_minutes -> timeSpentMinutes
 * - ClickUp: id -> externalId, date_closed -> completedAt, time_spent (ms) -> timeSpentMinutes
 * - Linear: id -> externalId, completedAt -> completedAt, estimate -> estimatePoints (no time tracking)
 */
export interface Task {
  id: string;
  organizationId: string;
  integrationId: string; // Reference to integration that synced this task

  // Provider identification
  provider: TaskProvider;
  externalId: string; // Provider's task ID

  // Core task data
  title: string;
  description?: string;
  status: TaskStatus;

  // Assignee (matched to Employee by email if possible)
  assigneeEmail?: string;
  assigneeExternalId?: string; // Provider's user ID
  assigneeName?: string;

  // Dates
  createdAt: string; // ISO string - when task was created in provider
  completedAt?: string; // ISO string - when task was marked complete
  dueAt?: string; // ISO string - task due date

  // Time tracking (Asana and ClickUp only)
  timeSpentMinutes?: number; // Total time tracked
  timeEstimateMinutes?: number; // Estimated time

  // Linear-specific (story points, not time)
  estimatePoints?: number;

  // Project/workspace context
  projectId?: string; // Provider's project/list ID
  projectName?: string;
  workspaceId?: string; // Provider's workspace/team ID

  // Sync metadata
  syncedAt: string; // ISO string - when we last synced this task
  updatedAt: string; // ISO string - when task was last modified in provider
}

/**
 * Sync state for task providers (same pattern as calendar)
 * Tracks incremental sync tokens
 */
export interface TaskSyncState {
  id: string;
  integrationId: string;
  organizationId: string;
  provider: TaskProvider;

  // Sync tokens vary by provider
  syncToken?: string; // Asana sync token
  lastSyncTimestamp?: number; // ClickUp uses timestamp
  cursor?: string; // Linear uses cursor-based pagination

  lastSyncAt: string;
  lastSyncStatus: "success" | "error" | "in_progress";
  lastError?: string;
  taskCount: number;
}
```

**Update packages/shared/src/types/index.ts:**
Add export for task types at the end:
```typescript
export * from "./task.js";
```
  </action>
  <verify>
```bash
cd packages/shared && npx tsc --noEmit
```
Types should compile without errors
  </verify>
  <done>Task, TaskStatus, TaskProvider, TaskTimeEntry, TaskSyncState types exported from shared package</done>
</task>

</tasks>

<verification>
- [ ] asana and @linear/sdk installed: `cd apps/api && npm ls asana @linear/sdk`
- [ ] Task types compile: `cd packages/shared && npx tsc --noEmit`
- [ ] Types exported: `grep -l "task" packages/shared/src/types/index.ts`
</verification>

<success_criteria>
1. asana SDK importable: `import Asana from "asana"`
2. Linear SDK importable: `import { LinearClient } from "@linear/sdk"`
3. Task type available: `import { Task, TaskProvider } from "@klayim/shared"`
4. TaskTimeEntry supports time tracking from Asana/ClickUp
5. Task.estimatePoints captures Linear story points (not time)
</success_criteria>

<output>
After completion, create `.planning/phases/07-task-management-integration/07-01-SUMMARY.md`
</output>
