---
phase: 01-user-onboarding
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - apps/web/src/app/auth/layout.tsx
  - apps/web/src/components/layouts/auth/index.tsx
  - apps/web/src/app/onboarding/layout.tsx
  - apps/web/src/app/onboarding/account-details/page.tsx
  - apps/web/src/app/onboarding/setup-organization/page.tsx
  - apps/web/src/components/layouts/onboarding/index.tsx
  - apps/web/src/components/pages/onboarding/account-details/index.tsx
  - apps/web/src/components/pages/onboarding/setup-organization/index.tsx
  - apps/web/src/lib/onboarding.ts
autonomous: false
requirements:
  - UONB-01
  - UONB-02
  - UONB-03

must_haves:
  truths:
    - "User can enter full name, password with live checklist, and confirm password"
    - "User can create organization with debounced name uniqueness check"
    - "User sees progress stepper with 4 steps throughout onboarding"
    - "User can navigate back to completed steps"
    - "Completed account details redirects to setup organization"
    - "Completed organization creation redirects to plan selection (Phase 2)"
  artifacts:
    - path: "apps/web/src/app/onboarding/account-details/page.tsx"
      provides: "Account details route"
      min_lines: 5
    - path: "apps/web/src/app/onboarding/setup-organization/page.tsx"
      provides: "Setup organization route"
      min_lines: 5
    - path: "apps/web/src/components/pages/onboarding/account-details/index.tsx"
      provides: "Account details form with TanStack Form"
      min_lines: 150
    - path: "apps/web/src/components/pages/onboarding/setup-organization/index.tsx"
      provides: "Organization creation form with uniqueness check"
      min_lines: 100
    - path: "apps/web/src/components/layouts/onboarding/index.tsx"
      provides: "Onboarding layout with stepper and animations"
      min_lines: 50
  key_links:
    - from: "apps/web/src/components/pages/onboarding/account-details/index.tsx"
      to: "/api/v1/auth/complete-profile"
      via: "fetch POST on form submit"
      pattern: "complete-profile"
    - from: "apps/web/src/components/pages/onboarding/setup-organization/index.tsx"
      to: "/api/v1/organizations"
      via: "fetch POST on form submit"
      pattern: "organizations"
    - from: "apps/web/src/components/pages/onboarding/setup-organization/index.tsx"
      to: "/api/v1/organizations/check-name"
      via: "debounced fetch for uniqueness"
      pattern: "check-name"
---

<objective>
Implement the complete user onboarding flow with Account Details and Organization Creation forms.

Purpose: Enable users to complete their profile (name + password) after email verification and create their first organization before proceeding to plan selection.

Output:
- Account Details page with name field, password with live checklist, confirm password with match indicator
- Organization Creation page with name field and real-time uniqueness validation
- Shared onboarding layout with stepper and slide animations
- Progress tracking with resume capability
</objective>

<execution_context>
@/Users/ardiansyahiqbal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ardiansyahiqbal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01/CONTEXT.md
@.planning/phases/01/01-RESEARCH.md
@.planning/phases/01/01-01-SUMMARY.md

# Existing patterns
@apps/web/src/components/pages/auth/signin/index.tsx
@apps/web/src/components/layouts/auth/index.tsx
@apps/web/src/app/auth/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Onboarding Layout with Stepper</name>
  <files>
apps/web/src/app/onboarding/layout.tsx
apps/web/src/components/layouts/onboarding/index.tsx
apps/web/src/lib/onboarding.ts
  </files>
  <action>
**Create apps/web/src/lib/onboarding.ts - Shared constants and utilities:**

```typescript
// Onboarding step definitions
export const ONBOARDING_STEPS = [
  { id: "create-account", label: "Create Account", href: "/auth/signup" },
  { id: "account-details", label: "Account Details", href: "/onboarding/account-details" },
  { id: "setup-organization", label: "Setup Organization", href: "/onboarding/setup-organization" },
  { id: "onboarding", label: "Onboarding", href: "/dashboard" }, // Points to org onboarding in Phase 3
] as const;

export type OnboardingStepId = typeof ONBOARDING_STEPS[number]["id"];

// Get current step index from pathname
export function getCurrentStepIndex(pathname: string): number {
  const stepIndex = ONBOARDING_STEPS.findIndex((step) =>
    pathname === step.href || pathname.startsWith(step.href + "/")
  );
  return stepIndex >= 0 ? stepIndex : 0;
}

// Determine step state
export function getStepState(
  stepIndex: number,
  currentIndex: number,
  userOnboardingCompleted: boolean,
  hasOrganization: boolean
): "completed" | "active" | "pending" {
  // Step 0 (Create Account) is always completed if user is here
  if (stepIndex === 0) return "completed";

  // Step 1 (Account Details) - completed if onboardingCompleted is true
  if (stepIndex === 1) {
    if (userOnboardingCompleted) return "completed";
    if (currentIndex === 1) return "active";
    return "pending";
  }

  // Step 2 (Setup Organization) - completed if has organization
  if (stepIndex === 2) {
    if (hasOrganization) return "completed";
    if (currentIndex === 2) return "active";
    return "pending";
  }

  // Step 3 (Onboarding) - active after org creation
  if (stepIndex === 3) {
    if (currentIndex === 3) return "active";
    return "pending";
  }

  return "pending";
}
```

**Create apps/web/src/components/layouts/onboarding/index.tsx:**

```typescript
"use client";

import { usePathname, useRouter } from "next/navigation";
import { motion, AnimatePresence } from "framer-motion";
import { Stepper } from "@/components/ui/stepper";
import { ONBOARDING_STEPS, getCurrentStepIndex, getStepState } from "@/lib/onboarding";
import { useSession } from "next-auth/react";
import { useEffect, useRef, useState } from "react";

interface OnboardingLayoutProps {
  children: React.ReactNode;
}

const OnboardingLayout: React.FC<OnboardingLayoutProps> = ({ children }) => {
  const pathname = usePathname();
  const router = useRouter();
  const { data: session, status } = useSession();
  const currentIndex = getCurrentStepIndex(pathname);
  const prevIndex = useRef(currentIndex);
  const [direction, setDirection] = useState(0);

  // Track direction for slide animation
  useEffect(() => {
    setDirection(currentIndex > prevIndex.current ? 1 : -1);
    prevIndex.current = currentIndex;
  }, [currentIndex]);

  // Derive step states from user data
  const userOnboardingCompleted = session?.user?.onboardingCompleted ?? false;
  const hasOrganization = !!session?.user?.defaultOrganizationId;

  const steps = ONBOARDING_STEPS.map((step, index) => ({
    ...step,
    state: getStepState(index, currentIndex, userOnboardingCompleted, hasOrganization),
  }));

  const handleStepClick = (stepIndex: number) => {
    const step = steps[stepIndex];
    // Only allow clicking completed steps (per user decision)
    if (step.state === "completed" && step.href) {
      router.push(step.href);
    }
  };

  // Page transition variants (per user decision - slide left/right)
  const pageVariants = {
    initial: (direction: number) => ({
      x: direction > 0 ? "100%" : "-100%",
      opacity: 0,
    }),
    animate: {
      x: 0,
      opacity: 1,
      transition: { type: "tween", duration: 0.3, ease: "easeInOut" },
    },
    exit: (direction: number) => ({
      x: direction > 0 ? "-100%" : "100%",
      opacity: 0,
      transition: { type: "tween", duration: 0.3, ease: "easeInOut" },
    }),
  };

  return (
    <div
      className="min-h-screen"
      style={{
        background: "url('/images/bg-particle.png') repeat",
      }}
    >
      <div className="flex min-h-screen flex-col items-center justify-center p-4">
        {/* Stepper - shown above the card */}
        <div className="mb-8 w-full max-w-md">
          <Stepper
            steps={steps.map((s) => ({ id: s.id, label: s.label, href: s.href }))}
            currentStep={currentIndex}
            onStepClick={handleStepClick}
            stepStates={steps.map((s) => s.state)}
          />
        </div>

        {/* Content with slide animation */}
        <div className="relative w-full max-w-md overflow-hidden">
          <AnimatePresence mode="wait" custom={direction}>
            <motion.div
              key={pathname}
              custom={direction}
              variants={pageVariants}
              initial="initial"
              animate="animate"
              exit="exit"
            >
              {children}
            </motion.div>
          </AnimatePresence>
        </div>
      </div>
    </div>
  );
};

export default OnboardingLayout;
```

**NOTE:** You may need to update the Stepper component to accept `stepStates` prop for overriding individual step states. Adjust if needed.

**Create apps/web/src/app/onboarding/layout.tsx:**

```typescript
import OnboardingLayout from "@/components/layouts/onboarding";

const Layout = ({ children }: { children: React.ReactNode }) => {
  return <OnboardingLayout>{children}</OnboardingLayout>;
};

export default Layout;
```
  </action>
  <verify>
- Files exist: layout.tsx, OnboardingLayout component, onboarding.ts utilities
- Imports compile: `cd /Users/ardiansyahiqbal/dev-app/myx/klayim && pnpm --filter @klayim/web exec tsc --noEmit`
- Stepper is imported from "@/components/ui/stepper"
- AnimatePresence from framer-motion is used for page transitions
  </verify>
  <done>
- Onboarding layout wraps children with Stepper above and slide animations
- Step states derived from session data (onboardingCompleted, defaultOrganizationId)
- Clicking completed steps navigates back
- Direction-aware slide transitions (left/right based on forward/back navigation)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Account Details Page</name>
  <files>
apps/web/src/app/onboarding/account-details/page.tsx
apps/web/src/components/pages/onboarding/account-details/index.tsx
  </files>
  <action>
**Create apps/web/src/app/onboarding/account-details/page.tsx (thin wrapper):**

```typescript
import AccountDetailsPage from "@/components/pages/onboarding/account-details";

export default function Page() {
  return <AccountDetailsPage />;
}
```

**Create apps/web/src/components/pages/onboarding/account-details/index.tsx:**

Follow the exact patterns from signin page but with these specific requirements:

```typescript
"use client";

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import { Field, FieldError, FieldGroup, FieldLabel } from "@/components/ui/field";
import { Input } from "@/components/ui/input";
import {
  InputGroup,
  InputGroupAddon,
  InputGroupButton,
  InputGroupInput,
} from "@/components/ui/input-group";
import {
  onboardingCompleteProfileSchema,
  nameSchema,
  onboardingPasswordSchema,
  PASSWORD_REQUIREMENTS,
} from "@klayim/shared/schemas";
import { useForm } from "@tanstack/react-form";
import { Eye, EyeOff, Check, Circle } from "lucide-react";
import { useSession } from "next-auth/react";
import Image from "next/image";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useState } from "react";
import { cn } from "@/lib/utils";
import { Spinner } from "@/components/ui/spinner";
import { env } from "next-runtime-env";

const AccountDetailsPage = () => {
  const router = useRouter();
  const { data: session, update: updateSession } = useSession();
  const [isLoading, setIsLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const form = useForm({
    defaultValues: {
      name: "",
      password: "",
      confirmPassword: "",
    },
    onSubmit: async ({ value }) => {
      setIsLoading(true);
      setError(null);

      try {
        const apiUrl = env("NEXT_PUBLIC_API_URL");
        const response = await fetch(`${apiUrl}/api/v1/auth/complete-profile`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify({
            name: value.name,
            password: value.password,
          }),
        });

        const data = await response.json();

        if (data.success) {
          // Update session to reflect completed profile
          await updateSession();
          router.push("/onboarding/setup-organization");
        } else {
          setError(data.error || "Failed to complete profile");
        }
      } catch {
        setError("Something went wrong. Please try again.");
      } finally {
        setIsLoading(false);
      }
    },
  });

  // Subscribe to password field for checklist
  const passwordValue = form.useStore((state) => state.values.password);
  const confirmPasswordValue = form.useStore((state) => state.values.confirmPassword);

  // Confirm password match indicator
  const passwordsMatch = passwordValue.length > 0 && passwordValue === confirmPasswordValue;

  return (
    <Card className="w-full border px-2">
      <CardHeader className="flex flex-col items-center gap-4 text-center">
        <Link href="/" className="flex flex-col items-center justify-center gap-2">
          <Image src="/images/logo/symbol.svg" alt="Klayim" width={32} height={32} />
          <Image src="/images/logo/text.svg" alt="Klayim" width={140} height={40} />
        </Link>
        <div>
          <h1 className="text-xl font-semibold">Complete Your Account</h1>
          <p className="text-muted-foreground text-sm">Enter your details to get started</p>
        </div>
      </CardHeader>

      <CardContent className="flex flex-col gap-6">
        {/* Display email (read-only per user decision) */}
        <Field>
          <FieldLabel>Email</FieldLabel>
          <Input
            type="email"
            value={session?.user?.email || ""}
            disabled
            className="h-11 bg-muted"
          />
          <p className="text-muted-foreground text-xs mt-1">Email verified and cannot be changed</p>
        </Field>

        <form
          onSubmit={(e) => {
            e.preventDefault();
            form.handleSubmit();
          }}
        >
          <FieldGroup>
            {/* Full Name Field */}
            <form.Field
              name="name"
              validators={{
                onChange: ({ value }) => {
                  const result = nameSchema.safeParse(value);
                  if (!result.success) {
                    return result.error.errors[0]?.message;
                  }
                  return undefined;
                },
              }}
            >
              {(field) => {
                const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid;
                return (
                  <Field data-invalid={isInvalid}>
                    <FieldLabel htmlFor={field.name}>Full Name</FieldLabel>
                    <Input
                      id={field.name}
                      name={field.name}
                      type="text"
                      placeholder="Enter your full name"
                      value={field.state.value}
                      onChange={(e) => field.handleChange(e.target.value)}
                      onBlur={field.handleBlur}
                      disabled={isLoading}
                      className="h-11"
                      aria-invalid={isInvalid}
                    />
                    {isInvalid && (
                      <FieldError
                        errors={field.state.meta.errors.map((err) => ({
                          message: typeof err === "string" ? err : String(err),
                        }))}
                      />
                    )}
                  </Field>
                );
              }}
            </form.Field>

            {/* Password Field with Live Checklist */}
            <form.Field
              name="password"
              validators={{
                onChange: ({ value }) => {
                  const result = onboardingPasswordSchema.safeParse(value);
                  if (!result.success) {
                    // Don't show error message here - use checklist instead
                    return undefined;
                  }
                  return undefined;
                },
              }}
            >
              {(field) => (
                <Field>
                  <FieldLabel htmlFor={field.name}>Password</FieldLabel>
                  <InputGroup className="h-11">
                    <InputGroupInput
                      id={field.name}
                      name={field.name}
                      type={showPassword ? "text" : "password"}
                      placeholder="Create a password"
                      value={field.state.value}
                      onChange={(e) => field.handleChange(e.target.value)}
                      onBlur={field.handleBlur}
                      disabled={isLoading}
                    />
                    <InputGroupAddon align="inline-end">
                      <InputGroupButton
                        type="button"
                        size="icon-sm"
                        onClick={() => setShowPassword(!showPassword)}
                        aria-label={showPassword ? "Hide password" : "Show password"}
                      >
                        {showPassword ? <EyeOff className="size-4" /> : <Eye className="size-4" />}
                      </InputGroupButton>
                    </InputGroupAddon>
                  </InputGroup>

                  {/* Live Password Checklist (per user decision) */}
                  <ul className="mt-2 space-y-1">
                    {PASSWORD_REQUIREMENTS.map((req) => {
                      const met = req.test(passwordValue);
                      return (
                        <li
                          key={req.id}
                          className={cn(
                            "flex items-center gap-2 text-sm",
                            met ? "text-green-600" : "text-muted-foreground"
                          )}
                        >
                          {met ? (
                            <Check className="size-4" />
                          ) : (
                            <Circle className="size-4" />
                          )}
                          {req.label}
                        </li>
                      );
                    })}
                  </ul>
                </Field>
              )}
            </form.Field>

            {/* Confirm Password Field with Live Match Indicator */}
            <form.Field
              name="confirmPassword"
              validators={{
                onChange: ({ value }) => {
                  if (value.length > 0 && value !== passwordValue) {
                    return "Passwords do not match";
                  }
                  return undefined;
                },
              }}
            >
              {(field) => {
                const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid;
                return (
                  <Field data-invalid={isInvalid}>
                    <FieldLabel htmlFor={field.name}>Confirm Password</FieldLabel>
                    <InputGroup className="h-11">
                      <InputGroupInput
                        id={field.name}
                        name={field.name}
                        type={showConfirmPassword ? "text" : "password"}
                        placeholder="Confirm your password"
                        value={field.state.value}
                        onChange={(e) => field.handleChange(e.target.value)}
                        onBlur={field.handleBlur}
                        disabled={isLoading}
                        aria-invalid={isInvalid}
                      />
                      <InputGroupAddon align="inline-end">
                        <InputGroupButton
                          type="button"
                          size="icon-sm"
                          onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                          aria-label={showConfirmPassword ? "Hide password" : "Show password"}
                        >
                          {showConfirmPassword ? <EyeOff className="size-4" /> : <Eye className="size-4" />}
                        </InputGroupButton>
                      </InputGroupAddon>
                    </InputGroup>

                    {/* Live Match Indicator (per user decision) */}
                    {confirmPasswordValue.length > 0 && (
                      <p
                        className={cn(
                          "mt-1 flex items-center gap-1 text-sm",
                          passwordsMatch ? "text-green-600" : "text-destructive"
                        )}
                      >
                        {passwordsMatch ? (
                          <>
                            <Check className="size-4" /> Passwords match
                          </>
                        ) : (
                          <>
                            <Circle className="size-4" /> Passwords do not match
                          </>
                        )}
                      </p>
                    )}
                  </Field>
                );
              }}
            </form.Field>

            {/* Error Message */}
            {error && <p className="text-destructive text-center text-sm">{error}</p>}

            {/* Submit Button - Always enabled per user decision */}
            <Button
              type="submit"
              disabled={isLoading}
              className="h-11 w-full"
            >
              {isLoading ? (
                <>
                  <Spinner className="mr-2 size-4" />
                  Saving...
                </>
              ) : (
                "Continue"
              )}
            </Button>
          </FieldGroup>
        </form>
      </CardContent>
    </Card>
  );
};

export default AccountDetailsPage;
```

**Key Implementation Details:**
- Email field is display-only (disabled, from session)
- Full Name uses single field (not first/last split)
- Password has live checklist using PASSWORD_REQUIREMENTS
- Confirm password has live match indicator
- Eye toggle on both password fields
- Continue button always enabled (per user decision)
- Loading state: disable form + spinner
- On success: redirect to /onboarding/setup-organization
  </action>
  <verify>
- Files exist: page.tsx route wrapper and index.tsx component
- Imports PASSWORD_REQUIREMENTS from @klayim/shared/schemas
- Uses TanStack Form's useStore for live password value
- Has live checklist for password requirements
- Has live match indicator for confirm password
- Eye toggles on both password fields
- TypeScript compiles: `pnpm --filter @klayim/web exec tsc --noEmit`
  </verify>
  <done>
- Account details form has email (display only), full name, password with live checklist, confirm password with match indicator
- Eye toggle on both password fields
- Continue button always enabled
- Loading state with spinner
- Redirects to setup-organization on success
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Setup Organization Page</name>
  <files>
apps/web/src/app/onboarding/setup-organization/page.tsx
apps/web/src/components/pages/onboarding/setup-organization/index.tsx
  </files>
  <action>
**Create apps/web/src/app/onboarding/setup-organization/page.tsx:**

```typescript
import SetupOrganizationPage from "@/components/pages/onboarding/setup-organization";

export default function Page() {
  return <SetupOrganizationPage />;
}
```

**Create apps/web/src/components/pages/onboarding/setup-organization/index.tsx:**

```typescript
"use client";

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import { Field, FieldError, FieldGroup, FieldLabel } from "@/components/ui/field";
import { Input } from "@/components/ui/input";
import { organizationNameSchema } from "@klayim/shared/schemas";
import { useForm } from "@tanstack/react-form";
import { Check, Loader2, X } from "lucide-react";
import { useSession } from "next-auth/react";
import Image from "next/image";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useState } from "react";
import { cn } from "@/lib/utils";
import { Spinner } from "@/components/ui/spinner";
import { env } from "next-runtime-env";

const SetupOrganizationPage = () => {
  const router = useRouter();
  const { update: updateSession } = useSession();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const form = useForm({
    defaultValues: {
      name: "",
    },
    onSubmit: async ({ value }) => {
      setIsLoading(true);
      setError(null);

      try {
        const apiUrl = env("NEXT_PUBLIC_API_URL");
        const response = await fetch(`${apiUrl}/api/v1/organizations`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify({
            name: value.name.trim(),
          }),
        });

        const data = await response.json();

        if (data.success) {
          // Update session with new organization
          await updateSession();
          // Redirect to plan selection (Phase 2)
          router.push("/onboarding/plan-selection");
        } else {
          setError(data.error || "Failed to create organization");
        }
      } catch {
        setError("Something went wrong. Please try again.");
      } finally {
        setIsLoading(false);
      }
    },
  });

  return (
    <Card className="w-full border px-2">
      <CardHeader className="flex flex-col items-center gap-4 text-center">
        <Link href="/" className="flex flex-col items-center justify-center gap-2">
          <Image src="/images/logo/symbol.svg" alt="Klayim" width={32} height={32} />
          <Image src="/images/logo/text.svg" alt="Klayim" width={140} height={40} />
        </Link>
        <div>
          <h1 className="text-xl font-semibold">Create Your Organization</h1>
          <p className="text-muted-foreground text-sm">Set up your workspace to get started</p>
        </div>
      </CardHeader>

      <CardContent className="flex flex-col gap-6">
        <form
          onSubmit={(e) => {
            e.preventDefault();
            form.handleSubmit();
          }}
        >
          <FieldGroup>
            {/* Organization Name Field with Debounced Uniqueness Check */}
            <form.Field
              name="name"
              asyncDebounceMs={300}
              validators={{
                onChange: ({ value }) => {
                  // Sync validation first
                  const result = organizationNameSchema.safeParse(value);
                  if (!result.success) {
                    return result.error.errors[0]?.message;
                  }
                  return undefined;
                },
                onChangeAsync: async ({ value }) => {
                  // Skip uniqueness check if sync validation fails
                  const syncResult = organizationNameSchema.safeParse(value);
                  if (!syncResult.success) {
                    return undefined;
                  }

                  // Debounced API call for uniqueness (per user decision - 300ms)
                  try {
                    const apiUrl = env("NEXT_PUBLIC_API_URL");
                    const response = await fetch(
                      `${apiUrl}/api/v1/organizations/check-name?name=${encodeURIComponent(value.trim())}`,
                      { credentials: "include" }
                    );
                    const data = await response.json();

                    if (!data.success) {
                      return "Unable to verify name availability";
                    }

                    if (!data.data.available) {
                      return data.data.suggestion
                        ? `Name already taken. Try "${data.data.suggestion}"?`
                        : "Name already taken";
                    }

                    return undefined;
                  } catch {
                    return "Unable to verify name availability";
                  }
                },
              }}
            >
              {(field) => {
                const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid;
                const isValidating = field.state.meta.isValidating;
                const isValid = field.state.meta.isTouched && field.state.meta.isValid && field.state.value.length >= 2;

                return (
                  <Field data-invalid={isInvalid}>
                    <FieldLabel htmlFor={field.name}>Organization Name</FieldLabel>
                    <div className="relative">
                      <Input
                        id={field.name}
                        name={field.name}
                        type="text"
                        placeholder="Enter organization name"
                        value={field.state.value}
                        onChange={(e) => field.handleChange(e.target.value)}
                        onBlur={field.handleBlur}
                        disabled={isLoading}
                        className={cn("h-11 pr-10")}
                        aria-invalid={isInvalid}
                      />
                      {/* Status indicator in input */}
                      <div className="absolute right-3 top-1/2 -translate-y-1/2">
                        {isValidating && (
                          <Loader2 className="size-4 animate-spin text-muted-foreground" />
                        )}
                        {!isValidating && isValid && (
                          <Check className="size-4 text-green-600" />
                        )}
                        {!isValidating && isInvalid && (
                          <X className="size-4 text-destructive" />
                        )}
                      </div>
                    </div>
                    <p className="text-muted-foreground text-xs mt-1">
                      2-50 characters. Letters, numbers, spaces, and hyphens only.
                    </p>
                    {isInvalid && (
                      <FieldError
                        errors={field.state.meta.errors.map((err) => ({
                          message: typeof err === "string" ? err : String(err),
                        }))}
                      />
                    )}
                  </Field>
                );
              }}
            </form.Field>

            {/* Error Message */}
            {error && <p className="text-destructive text-center text-sm">{error}</p>}

            {/* Submit Button */}
            <Button
              type="submit"
              disabled={isLoading}
              className="h-11 w-full"
            >
              {isLoading ? (
                <>
                  <Spinner className="mr-2 size-4" />
                  Creating...
                </>
              ) : (
                "Create Organization"
              )}
            </Button>
          </FieldGroup>
        </form>
      </CardContent>
    </Card>
  );
};

export default SetupOrganizationPage;
```

**Key Implementation Details:**
- Uses TanStack Form's `asyncDebounceMs={300}` for debounced uniqueness check (per user decision)
- Sync validation runs first (length, format), async only runs if sync passes
- Shows loading spinner during validation
- Shows checkmark when valid and available
- Shows X when invalid
- Suggests alternative name if taken (from API response)
- On success: redirect to /onboarding/plan-selection (Phase 2)
  </action>
  <verify>
- Files exist: page.tsx and index.tsx
- Uses asyncDebounceMs={300} for uniqueness check
- Shows validation status icons (loading, check, x)
- Calls /api/v1/organizations/check-name for availability
- Calls POST /api/v1/organizations to create
- TypeScript compiles: `pnpm --filter @klayim/web exec tsc --noEmit`
  </verify>
  <done>
- Organization name field has real-time validation
- Debounced uniqueness check at 300ms
- Visual indicators: spinner during check, checkmark when valid, X when invalid
- Suggests alternative name if taken
- Redirects to plan selection on success
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Complete Onboarding Flow</name>
  <what-built>
Complete user onboarding flow with:
1. Stepper showing 4 steps (Create Account > Account Details > Setup Organization > Onboarding)
2. Account Details form with live password checklist and confirm password match indicator
3. Setup Organization form with debounced name uniqueness check
4. Slide animations between pages
5. Progress tracking via session state
  </what-built>
  <how-to-verify>
**Prerequisites:**
- Start development servers: `pnpm dev` (should start both web and API)
- Have a test user that has completed email verification but NOT completed profile

**Test Flow:**

1. **Navigate to Account Details:**
   - Visit http://localhost:3000/onboarding/account-details
   - Verify stepper shows above the form
   - Verify "Create Account" step shows checkmark (completed)
   - Verify "Account Details" is highlighted (current)
   - Verify "Setup Organization" and "Onboarding" are muted (pending)

2. **Test Account Details Form:**
   - Verify email is displayed but not editable
   - Enter name (e.g., "Test User")
   - Start typing password - verify live checklist updates in real-time
   - Verify each requirement shows checkmark when met
   - Type confirm password - verify match indicator shows in real-time
   - Click eye icon - verify password visibility toggles
   - Click Continue with valid data
   - Verify page slides to Setup Organization

3. **Test Setup Organization Form:**
   - Verify stepper shows "Account Details" completed
   - Type organization name slowly
   - Verify loading spinner appears during validation
   - Verify checkmark appears when name is valid and available
   - Try a common name that might be taken
   - Verify error message with suggestion appears if name taken
   - Submit valid unique name
   - Verify redirect to /onboarding/plan-selection (may 404 - that's Phase 2)

4. **Test Back Navigation:**
   - Click on "Account Details" step in stepper
   - Verify page slides back
   - Verify form values are not preserved (each step submits to API)

5. **Test Mobile View:**
   - Resize browser to mobile width (<768px)
   - Verify stepper shows "Step X of Y" format instead of full steps

**Expected Behavior:**
- Smooth slide animations between pages
- Real-time validation feedback
- Loading states during API calls
- Proper error handling

**Report any issues with specific details.**
  </how-to-verify>
  <resume-signal>Type "approved" if flow works correctly, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. TypeScript compiles for web app: `pnpm --filter @klayim/web exec tsc --noEmit`
2. Navigate through complete flow: /onboarding/account-details -> /onboarding/setup-organization
3. Stepper reflects correct state at each step
4. Slide animations work between pages
5. Mobile view shows "Step X of Y"
</verification>

<success_criteria>
- [ ] Onboarding layout exists with Stepper and slide animations
- [ ] Account Details page has email (read-only), name, password with checklist, confirm password with match indicator
- [ ] Setup Organization page has name field with debounced uniqueness check
- [ ] Both password fields have eye toggle
- [ ] Completed steps are clickable in stepper
- [ ] Mobile shows "Step X of Y" format
- [ ] Pages slide left/right based on navigation direction
- [ ] Human verification of complete flow passed
</success_criteria>

<output>
After completion, create `.planning/phases/01/01-02-SUMMARY.md`
</output>
